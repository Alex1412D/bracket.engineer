<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PSU Bracket Designer</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        height: 100vh;
        overflow: hidden;
      }
      .container {
        display: flex;
        gap: 20px;
        max-width: 1200px;
        margin: 0 auto;
        height: calc(100vh - 40px);
      }
      .preview {
        flex: 1;
        min-width: 0;
        height: 100%;
      }
      .preview canvas {
        width: 100%;
        height: 100%;
        display: block;
      }
      .controls {
        width: 300px;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 8px;
        overflow-y: auto;
      }
      .control-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }
      input[type="range"] {
        width: 100%;
      }
      .value-display {
        font-size: 0.9em;
        color: #666;
        text-align: right;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <canvas class="preview" id="preview"></canvas>
      <div class="controls" id="controls">
        <div class="control-group">
          <label for="width">Width (mm)</label>
          <input
            type="range"
            id="width"
            min="30"
            max="200"
            step="1"
            value="57"
          />
          <div class="value-display" id="width-value">57</div>
        </div>
        <div class="control-group">
          <label for="depth">Depth (mm)</label>
          <input
            type="range"
            id="depth"
            min="5"
            max="100"
            step="1"
            value="33"
          />
          <div class="value-display" id="depth-value">33</div>
        </div>
        <div class="control-group">
          <label for="height">Bracket Height (mm)</label>
          <input
            type="range"
            id="height"
            min="5"
            max="30"
            step="1"
            value="15"
          />
          <div class="value-display" id="height-value">15</div>
        </div>
        <div class="control-group">
          <label for="bracket-thickness">Bracket Thickness (mm)</label>
          <input
            type="range"
            id="bracket-thickness"
            min="2"
            max="10"
            step="0.5"
            value="3"
          />
          <div class="value-display" id="bracket-thickness-value">3</div>
        </div>
        <div class="control-group">
          <label for="ribbing-count">Number of Ribs</label>
          <input
            type="range"
            id="ribbing-count"
            min="0"
            max="10"
            step="1"
            value="2"
          />
          <div class="value-display" id="ribbing-count-value">3</div>
        </div>
        <div class="control-group">
          <label for="ribbing-thickness">Rib Thickness (mm)</label>
          <input
            type="range"
            id="ribbing-thickness"
            min="1"
            max="5"
            step="0.5"
            value="2"
          />
          <div class="value-display" id="ribbing-thickness-value">2</div>
        </div>
        <div class="control-group">
          <label for="hole-diameter">Hole Diameter (mm)</label>
          <input
            type="range"
            id="hole-diameter"
            min="0"
            max="8"
            step="0.1"
            value="2"
          />
          <div class="value-display" id="hole-diameter-value">4</div>
        </div>
        <div class="control-group">
          <label for="ear-width">Ear Width (mm)</label>
          <input
            type="range"
            id="ear-width"
            min="5"
            max="30"
            step="1"
            value="15"
          />
          <div class="value-display" id="ear-width-value">15</div>
        </div>
      </div>
    </div>

    <script type="module">
      import { setupPreview } from "./preview.ts";
      import { defaultParams } from "./psu-bracket.ts";

      const canvas = document.getElementById("preview");
      const updateBracket = setupPreview(canvas);

      // Get all range inputs
      const inputs = {
        width: document.getElementById("width"),
        depth: document.getElementById("depth"),
        height: document.getElementById("height"),
        "bracket-thickness": document.getElementById("bracket-thickness"),
        "ribbing-count": document.getElementById("ribbing-count"),
        "ribbing-thickness": document.getElementById("ribbing-thickness"),
        "hole-diameter": document.getElementById("hole-diameter"),
        "ear-width": document.getElementById("ear-width"),
      };

      // Get all value displays
      const displays = {
        width: document.getElementById("width-value"),
        depth: document.getElementById("depth-value"),
        height: document.getElementById("height-value"),
        "bracket-thickness": document.getElementById("bracket-thickness-value"),
        "ribbing-count": document.getElementById("ribbing-count-value"),
        "ribbing-thickness": document.getElementById("ribbing-thickness-value"),
        "hole-diameter": document.getElementById("hole-diameter-value"),
        "ear-width": document.getElementById("ear-width-value"),
      };

      // Function to update the bracket
      function update() {
        const params = {
          width: parseFloat(inputs.width.value),
          depth: parseFloat(inputs.depth.value),
          height: parseFloat(inputs.height.value),
          bracketThickness: parseFloat(inputs["bracket-thickness"].value),
          ribbingCount: parseInt(inputs["ribbing-count"].value),
          ribbingThickness: parseFloat(inputs["ribbing-thickness"].value),
          holeDiameter: parseFloat(inputs["hole-diameter"].value),
          earWidth: parseFloat(inputs["ear-width"].value),
        };
        updateBracket(params);
      }

      // Add event listeners to all inputs
      Object.entries(inputs).forEach(([key, input]) => {
        input.addEventListener("input", () => {
          displays[key].textContent = input.value;
          update();
        });
      });

      // Initial update
      update();
    </script>
  </body>
</html>
